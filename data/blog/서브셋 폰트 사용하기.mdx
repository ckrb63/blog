---
title: 한글 폰트 최적화하기
date: '2022-12-29'
tags: ['프론트엔드', '성능최적화']
draft: false
summary: 한글은 조합 시 총 11,172자 입니다
---
`Chrome Lighthouse`로 성능을 확인하면 `Avoid enormous network payloads`에서 거의 가장 큰 항목은 무엇일까요?

**한글 폰트**입니다.

## Avoid enormous network payloads

> 막대한 네트워크 페이로드 방지
> 

> 대규모 네트워크 페이로드는 긴 로드 시간과 높은 상관관계가 있습니다. 또한 사용자는 이로 인해 많은 비용을 지불해야 합니다. 예를 들어 사용자는 더 많은 셀룰러 데이터에 대한 비용을 지불해야 할 수 있습니다. 따라서 사이트와 지갑에서 사용자 환경을 개선하기 위해 페이지 네트워크 요청의 전체 크기를 줄이는 것이 좋습니다. - Chrome Developers
> 

우리는 흔히 네트워크 요청의 전체크기가 크면 다음의 원인을 예상할 것입니다.

- 이미지
- 코드

이것을 해결하기 위해 다음과 같은 방법들을 고려할 것입니다.

- 네트워크 페이로드 최소화 + 압축
- 이미지 파일 압축 + WebP 사용
- 캐싱 전략
- 번들 파일 분리

실제로 Chrome Developers에 `Avoid enormous network payloads` 가이드를 봐도 폰트에 대한 말은 없습니다. 그러나 우리가 만든 페이지를 Lighthouse로 검사하면 이러한 화면을 볼 수 있습니다.

![](https://velog.velcdn.com/images/cksrb63/post/0b968f3d-70d3-4ed0-a27a-5c776586516d/image.png)


참고로 chrome에서 제시하는 권장 사항은 **네트워크 페이로드** **전체 크기를 `1600KiB` 미만으로 유지하라** 입니다.
그치만 보이는 대로 하나의 폰트만 다운로드 받았을 뿐인데 `13,000KiB`를 넘습니다.

### 폰트 사이즈가 원래 이렇게 클까요? 폰트를 잘못 다운받은 건가?

`ttf` 폰트를 사용하는 것은 어찌보면 잘못 다운받았다고 할 수도 있겠습니다. 왜냐하면 `woff2`형식의 폰트를 사용하면 더 작은 사이즈로 폰트를 사용할 수 있기 때문입니다. 그치만 13,000 정도의 크기가 형식을 변환한다고 해서 얼만큼 작아질 수 있을까라는 생각이 남아 있습니다.

### 폰트가 페이로드 크기의 대부분을 차지하는데 왜 Chrome 가이드에는 폰트 언급이 없지?

**모든** 폰트 사이즈가 원래 이렇게 크지 않기 때문입니다. 해당 폰트는 `한글` 폰트이기 때문에 사이즈가 큰 것입니다. ttf 형식의 폰트여도 `영어` 폰트 였다면 사이즈는 크게 고려하지 않아도 될 수준입니다. 왜냐하면 영어는 알파벳 수가 **26**개지만 알파벳끼리 조합할 수 없고 나열될 뿐입니다. 반면 한글은 조합시 총 **11,172**자 입니다. 

## 한글 폰트 최적화
한글 폰트는 단순히 `woff2`로 변환하기만 해서 해결될 문제가 아닙니다.
![](https://velog.velcdn.com/images/cksrb63/post/56254bf4-a651-4e13-906b-842ca76cd943/image.png)
`woff2`로 변환해도 각각 `5,000KiB`가 넘어 도저히 총 `1,600KiB`는 맞추기 어려워 보입니다. 더욱이 우리는 사실 폰트 말고 다른 파일들도 고려해서 `1,600KiB`를 맞춰야 합니다. 그렇게 하려면 폰트 크기를 더욱 극단적으로 줄일 필요가 있습니다.

### 그럼 어떻게 줄여야 할까요?

다음의 과정을 거치면 한글 폰트도 `100KiB` 단위로 줄이는게 가능합니다.

1. 폰트 내에 있는 한글 조합 중 실생활에 사용되지 않는 글자들을 뺀 `서브셋 폰트`를 사용한다.
2. 폰트는 `ttf`, `otf`, `eot` 같은 형식말고 `woff2` 방식을 사용한다.

그럼 `SpoqaHansSansNeo.ttf` 폰트를 서브셋 폰트로 만들고 `woff2`로 변환하는 과정을 보겠습니다.

먼저 [https://opentype.jp/subsetfontmk.htm](https://opentype.jp/subsetfontmk.htm) 그리고 [https://opentype.jp/woffconv.htm](https://opentype.jp/woffconv.htm) 에서 파일을 다운로드 합니다.

요즘엔 서브셋 폰트를 만들어 주는 웹 서비스(https://transfonter.org) 를 이용하는 방식도 있지만 이 글에서는 위의 프로그램을 통해 변환하겠습니다. 
![](https://velog.velcdn.com/images/cksrb63/post/f68a1a26-94a6-4f10-b229-c901bf1d16af/image.png)


1. 변환할 폰트 선택
2. 변환된 폰트 이름, 위치 지정
3. 포함할 글자 선택
4. 폰트 패밀리 지정
5. 변환 완료시 바로 같이 설치한 `woff2` 컨버터로 연결
6. 변환

![](https://velog.velcdn.com/images/cksrb63/post/0c1a13c3-66b5-46f9-9247-e97d98767605/image.png)


1. 변환할 폰트 선택(이전 단계에서 자동으로 연결됩니다)
2. 변환된 폰트 이름, 위치 지정
3. `woff2` 파일로 생성
4. 변환

이렇게 폰트를 바꾸고 다시 lighthouse에서 확인해보겠습니다.
![](https://velog.velcdn.com/images/cksrb63/post/3af7a649-90d7-4cf9-aa6a-e4a48a696bdb/image.png)
폰트의 사이즈를 많이 줄였습니다. 이제 총합 `1,600KiB` 로 맞추는 것이 충분히 가능합니다.